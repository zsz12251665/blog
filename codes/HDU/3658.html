<h2 id="title">HDU 3658</h2>
<time>2018-04-09 20:55 by zsz12251665</time>
<h3>Problem</h3>
<section class="buttonField">
	<a target="_blank" href="https://vjudge.net/problem/HDU-3658">vjudge</a>
	<a target="_blank" href="http://acm.hdu.edu.cn/showproblem.php?pid=3658">HDU</a>
</section>
<h3>Solution</h3>
<section>
	<p>In this problem, we will talk about how to use the power of the matrix to speed up <abbr title="dynamic planning">dp</abbr> algorithm. </p>
	<p>The dp array will be like <data value="v{dp}b{v{i}o{,}v{j}o{,}v{c}}"></data>, which means the number of the words when we have chosen the first <data value="v{i}"></data> letters,  with <data value="v{j}"></data> as the last one and <data value="v{c}"></data> which shows if there has been a difference of a pair of neighbour letters which is exactly 32. Now we can write down the state transition formulas: </p>
	<ul>
		<li><data value="v{dp}b{v{i}o{,}v{j}o{,}c{0}}o{=}o{&sum;}i{v{j}o{+}c{31}l{}v{k}o{=}v{j}o{-}c{31}}v{dp}b{v{i}o{-}c{1}o{,}v{k}o{,}c{0}}"></data></li>
		<li><data value="v{dp}b{v{i}o{,}v{j}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}v{j}o{&plusmn;}c{32}o{,}c{0}}o{+}o{&sum;}i{v{j}o{+}c{32}l{}v{k}o{=}v{j}o{-}c{32}}v{dp}b{v{i}o{-}c{1}o{,}v{k}o{,}c{0}}"></data></li>
	</ul>
	<p>If we roll the dp array, change the difference of 'Z' and 'a' into 1 and then combine <data value="v{j}"></data> and <data value="v{c}"></data> as <data value="o{(}c{52}o{}v{c}o{+}v{j}o{)}"></data>, we'll have these formulas: </p>
	<ul>
		<li><data value="v{dp}b{v{j}}o{=}o{&sum;}i{v{j}o{+}c{25}l{}v{k}o{=}v{j}o{-}c{25}}v{dp}b{v{k}}"></data></li>
		<li><data value="v{dp}b{v{j}o{+}c{52}}o{=}v{dp}b{v{j}o{&plusmn;}c{26}}o{+}o{&sum;}i{v{j}o{+}c{26}l{}v{k}o{=}v{j}o{-}c{26}}v{dp}b{v{k}o{+}c{52}}}"></data></li>
	</ul>
	<p>Obviously, it took us <data value="o{O}o{(}c{2}o{&times;}c{52}o{)}"></data> to finish a transition. Though the total time complexity is just <data value="o{O}o{(}v{m}o{)}"></data>, the constant and the multitasks will not allow us to pass the problem. So we need the power of the matrix to speed up. But how can we do it? </p>
	<p>We will construct a transition matrix. For a transition matrix <data value="v{M}"></data>, <data value="v{M}b{v{x}o{,}v{y}}"></data> is the coefficient of <data value="v{dp}b{v{y}}"></data> in <data value="v{dp}b{v{x}}"></data>. Let's take Fibonacci sequence as an example. The transition matrix is <data value="o{[}i{c{1}l{}c{1}}o{&nbsp;}i{c{1}l{}c{0}}o{]}"></data>. Here, <data value="v{dp}b{v{i}o{,}c{0}}"></data> means <data value="v{F}b{v{i}}"></data> while <data value="v{dp}b{v{i}o{,}c{1}}"></data> means <data value="v{F}b{v{i}o{-}c{1}}"></data>. So according to the transition matrix, the transition formulas are <data value="v{dp}b{v{i}o{,}c{0}}o{=}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}v{dp}b{v{i}o{-}c{1}o{,}c{1}}"></data> and <data value="v{dp}b{v{i}o{,}c{1}}o{=}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}c{0}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}c{0}}"></data>. They just mean <data value="v{F}b{v{i}}o{=}v{F}b{v{i}o{-}c{1}}o{+}v{F}b{v{i}o{-}c{2}}"></data> and <data value="v{F}b{v{i}o{-}c{1}}o{=}v{F}b{v{i}o{-}c{1}}"></data>. </p>
	<p>After constructing the transition matrix, we could know that if we multiply the matrix with the states array, we can finish the transition once. So we need to do it <data value="v{m}"></data> times. According to the associative property, we can use the power of the matrix, which is just <data value="o{O}o{(}o{lg}v{m}o{)}"></data>, to speed it up. This is how we speed up dp algorithm with the power of matrix. </p>
	<p>P. S. I'm sorry that the solution was still not fast enough for Pascal to pass it while C++ managed though I've sorted <data value="v{m}"></data>. Please pay attenttion. </p>
</section>
<h3>Code</h3>
<section>
	<p>Pascal</p>
	<code lang="pas"></code>
	<p>C++</p>
	<code lang="cpp"></code>
</section>

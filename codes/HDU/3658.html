<h2 align="center">HDU 3658</h2>
<time>2018-04-09 20:55 by zsz12251665</time>
<h3>Problem</h3>
<section class="btnfield">
	<a target="_blank" href="https://vjudge.net/problem/HDU-3658">vjudge</a>
	<a target="_blank" href="http://acm.hdu.edu.cn/showproblem.php?pid=3658">HDU</a>
</section>
<h3>Solution</h3>
<section>
	<p>In this problem, we will talk about how to use the power of the matrix to speed up <abbr title="dynamic planning">dp</abbr> algorithm. </p>
	<p>The dp array will be like <math>v{dp}b{v{i}o{,}v{j}o{,}v{c}}</math>, which means the number of the words when we have chosen the first <math>v{i}</math> letters,  with <math>v{j}</math> as the last one and <math>v{c}</math> which shows if there has been a difference of a pair of neighbour letters which is exactly 32. Now we can write down the state transition formulas: </p>
	<ul>
		<li><math>v{dp}b{v{i}o{,}v{j}o{,}c{0}}o{=}o{&sum;}i{v{j}o{+}c{31}l{}v{k}o{=}v{j}o{-}c{31}}v{dp}b{v{i}o{-}c{1}o{,}v{k}o{,}c{0}}</math></li>
		<li><math>v{dp}b{v{i}o{,}v{j}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}v{j}o{&plusmn;}c{32}o{,}c{0}}o{+}o{&sum;}i{v{j}o{+}c{32}l{}v{k}o{=}v{j}o{-}c{32}}v{dp}b{v{i}o{-}c{1}o{,}v{k}o{,}c{0}}</math></li>
	</ul>
	<p>If we roll the dp array, change the difference of 'Z' and 'a' into 1 and then combine <math>v{j}</math> and <math>v{c}</math> as <math>o{(}c{52}o{}v{c}o{+}v{j}o{)}</math>, we'll have these formulas: </p>
	<ul>
		<li><math>v{dp}b{v{j}}o{=}o{&sum;}i{v{j}o{+}c{25}l{}v{k}o{=}v{j}o{-}c{25}}v{dp}b{v{k}}</math></li>
		<li><math>v{dp}b{v{j}o{+}c{52}}o{=}v{dp}b{v{j}o{&plusmn;}c{26}}o{+}o{&sum;}i{v{j}o{+}c{26}l{}v{k}o{=}v{j}o{-}c{26}}v{dp}b{v{k}o{+}c{52}}}</math></li>
	</ul>
	<p>Obviously, it took us <math>o{O}o{(}c{2}o{&times;}c{52}o{)}</math> to finish a transition. Though the total time complexity is just <math>o{O}o{(}v{m}o{)}</math>, the constant and the multitasks will not allow us to pass the problem. So we need the power of the matrix to speed up. But how can we do it? </p>
	<p>We will construct a transition matrix. For a transition matrix <math>v{M}</math>, <math>v{M}b{v{x}o{,}v{y}}</math> is the coefficient of <math>v{dp}b{v{y}}</math> in <math>v{dp}b{v{x}}</math>. Let's take Fibonacci sequence as an example. The transition matrix is <math>o{[}i{c{1}l{}c{1}}o{&nbsp;}i{c{1}l{}c{0}}o{]}</math>. Here, <math>v{dp}b{v{i}o{,}c{0}}</math> means <math>v{F}b{v{i}}</math> while <math>v{dp}b{v{i}o{,}c{1}}</math> means <math>v{F}b{v{i}o{-}c{1}}</math>. So according to the transition matrix, the transition formulas are <math>v{dp}b{v{i}o{,}c{0}}o{=}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}v{dp}b{v{i}o{-}c{1}o{,}c{1}}</math> and <math>v{dp}b{v{i}o{,}c{1}}o{=}c{1}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{0}}o{+}c{0}o{&sdot;}v{dp}b{v{i}o{-}c{1}o{,}c{1}}o{=}v{dp}b{v{i}o{-}c{1}o{,}c{0}}</math>. They just mean <math>v{F}b{v{i}}o{=}v{F}b{v{i}o{-}c{1}}o{+}v{F}b{v{i}o{-}c{2}}</math> and <math>v{F}b{v{i}o{-}c{1}}o{=}v{F}b{v{i}o{-}c{1}}</math>. </p>
	<p>After constructing the transition matrix, we could know that if we multiply the matrix with the states array, we can finish the transition once. So we need to do it <math>v{m}</math> times. According to the associative property, we can use the power of the matrix, which is just <math>o{O}o{(}o{lg}v{m}o{)}</math>, to speed it up. This is how we speed up dp algorithm with the power of matrix. </p>
	<p>P. S. I'm sorry that the solution was still not fast enough for Pascal to pass it while C++ managed though I've sorted <math>v{m}</math>. Please pay attenttion. </p>
</section>
<h3>Code</h3>
<section>
	<p>Pascal</p>
	<code></code>
	<p>C++</p>
	<code></code>
</section>
